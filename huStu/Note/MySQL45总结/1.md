# MySQL长连接出现的问题

## 内存占用涨的特别快

### 原因
+ MySQL在执行过程中临时使用的内存是管理再连接对象里的,这些资源只会在连接断开的时候释放.如果长期积累下来,可能会导致内存占用过大,为系统kill掉,从现象看就是MySQL异常重启了.

### 解决方法
+ 定期断开长连接.
> 使用一段时间,或者程序里面判断执行过一个占用内存的大查询后,断开连接,之后查询再重新连接.

+ 如果是MySQL5.7及以上,可以每次执行一个大操作后,通过执行mysql_reset_connection来重新初始化连接资源.
> 这个过程不需要重连和重新做权限验证,但是会将连接恢复到刚建立的状态.


# MySQL查询缓存

> 查询缓存弊大于利,只要对有一个表的更新,该表上所有的查询缓存都会被清空.所以对于静态表来说,查询缓存益处多.

+ MySQL提供按需使用查询缓存
> 将query_cache_type设置成DEMAND，这样对于默认的SQL语句都不使用查询缓存,而对显式指定的语句使用查询缓存.
```sql
select SQL_CACHE *from T where ID=10
```

+ **8.0之后将该功能删除**


# MySQL慢查询日志
+ rows_examined字段
> 表示语句执行过程中扫描了多少行,该值在执行器每次调用引擎获取数据行的时候累加.(但不一定相同,有时候执行器调用一次,引擎内部扫描多行).

  